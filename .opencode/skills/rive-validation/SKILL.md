---
name: rive-validation
description: Validation and debugging skill for Rive .riv files. Covers generate/validate/inspect pipeline, common errors, and debugging workflow.
---

# Rive Validation and Debugging

Skill for verifying and debugging Rive .riv files generated by rive-rs-cli.

## A. Validation Pipeline

After creating a scene JSON file, always run this sequence:

Step 1 — Generate:
```bash
cargo run --quiet -- generate input.json -o output.riv
```
- Exit 0 = JSON parsed and .riv binary created
- Non-zero = scene JSON has errors (check stderr)

Step 2 — Validate:
```bash
cargo run --quiet -- validate output.riv
```
- Checks binary structural correctness
- Reports: header validity, object count, property integrity

Step 3 — Inspect:
```bash
cargo run --quiet -- inspect output.riv --json
```
- Dumps full object tree as JSON
- Use to verify object hierarchy, property values, parent-child relationships

Step 4 — Filtered Inspect (for debugging specific objects):
```bash
cargo run --quiet -- inspect output.riv --type-key 1       # Artboard objects only
cargo run --quiet -- inspect output.riv --type-name shape   # By type name
cargo run --quiet -- inspect output.riv --object-index 3    # Specific object
cargo run --quiet -- inspect output.riv --property-key 4    # Objects with name property
```

## B. Common Error Patterns and Fixes

Error: "missing field `scene_format_version`"
Fix: Add "scene_format_version": 1 to root JSON

Error: "missing field `name`" / "missing field `children`"
Fix: Every object needs a name, artboards need children array

Error: "unknown preset"
Fix: Use one of: mobile, tablet, desktop, square, banner, story

Error: "must specify non-zero width and height"
Fix: Artboard needs width > 0 and height > 0 (or use a preset)

Error: "duplicate name"
Fix: All object names within an artboard must be unique

Error: "animation references unknown object"
Fix: keyframe "object" field must match an existing child's name exactly (case-sensitive)

Error: "state machine references unknown animation"
Fix: animation state's "animation" field must match an animation name

Error: "unknown variant" / serde deserialization error
Fix: Check "type" field uses snake_case: "solid_color" not "solidColor" or "SolidColor"

## C. Debugging Workflow

1. If generate fails: the scene JSON has structural errors. Read stderr carefully — serde gives line/column numbers.
2. If validate fails: the binary is malformed. Usually means a bug in the builder, not in your JSON. File an issue.
3. If inspect shows unexpected values: compare your JSON input against the inspect output to find where values diverged.
4. If the .riv loads in runtime but looks wrong: inspect the object tree, check parent-child hierarchy, verify property values.

## D. Quick Verification One-Liner

```bash
cargo run --quiet -- generate input.json -o /tmp/test.riv && cargo run --quiet -- validate /tmp/test.riv && echo "VALID" || echo "FAILED"
```

## E. Inspect Output Reading

The inspect JSON output has this structure:
```json
{
  "header": {"major": 7, "minor": 0, "file_id": 0},
  "toc": {"property_keys": [...], "backing_types": [...]},
  "objects": [
    {"index": 0, "type_key": 23, "type_name": "Backboard", "properties": []},
    {"index": 1, "type_key": 1, "type_name": "Artboard", "properties": [
      {"key": 7, "name": "width", "value": 500.0},
      {"key": 8, "name": "height", "value": 500.0},
      {"key": 4, "name": "name", "value": "Main"}
    ]}
  ]
}
```
- Object index 0 is always Backboard
- Object index 1+ are artboard and its children
- Properties show key number, human name, and value

## F. Expected Object Counts for Common Patterns

- Empty artboard: 2 objects (Backboard + Artboard)
- Single shape with fill: 5 objects (Backboard, Artboard, Shape, Ellipse, Fill, SolidColor) = 6
- Shape with animation: 6+ objects + KeyedObject + KeyedProperty + KeyFrame objects
- State machine adds: StateMachine, Layer, States, Transitions, Conditions
